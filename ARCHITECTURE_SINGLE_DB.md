# Architecture: 1 Database Duy Nháº¥t TrÃªn VPS

## ğŸ—ï¸ Kiáº¿n TrÃºc CÅ© (3 Database RiÃªng Biá»‡t)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LOCALHOST (Development)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚   Backend    â”‚ â”€â”€â”€â”€â†’ SQLite (utility.db)                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     âŒ KHÃ”NG Äá»’NG Bá»˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VPS PRODUCTION (165.99.59.47)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   Backend    â”‚ â”€â”€â”€â”€â†’  â”‚  PostgreSQL     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  (Docker)       â”‚               â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Váº¥n Ä‘á»:**
- âŒ 2 loáº¡i database khÃ¡c nhau
- âŒ Data khÃ´ng sync
- âŒ Schema cÃ³ thá»ƒ khÃ¡c
- âŒ KhÃ³ test production data

---

## ğŸ¯ Kiáº¿n TrÃºc Má»›i (1 Database Duy Nháº¥t)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LOCALHOST (Development)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚   Backend    â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚         â”‚                                                    â”‚
â”‚         â”‚  SSH Tunnel                                       â”‚
â”‚         â”‚  localhost:5432 â†’ VPS:5432                        â”‚
â”‚         â”‚  (Encrypted)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚  ğŸ”’ SSH Connection (Port 22)
          â”‚
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VPS PRODUCTION (165.99.59.47)                              â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   Backend    â”‚ â”€â”€â”€â”€â†’  â”‚  PostgreSQL     â”‚               â”‚
â”‚  â”‚  (Production)â”‚        â”‚  (Docker)       â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚                 â”‚               â”‚
â”‚                          â”‚  utility_db     â”‚               â”‚
â”‚  Localhost Backend â”€â”€â”€â”€â†’ â”‚  (Duy nháº¥t!)    â”‚               â”‚
â”‚  (via SSH tunnel)        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Lá»£i Ã­ch:**
- âœ… **1 database duy nháº¥t**
- âœ… Real-time sync tá»± Ä‘á»™ng
- âœ… Production parity 100%
- âœ… Test vá»›i data tháº­t

---

## ğŸ” SSH Tunnel Chi Tiáº¿t

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  YOUR COMPUTER (Localhost)                                  â”‚
â”‚                                                              â”‚
â”‚  1ï¸âƒ£  Backend App                                            â”‚
â”‚      â†“ Connect to localhost:5432                            â”‚
â”‚                                                              â”‚
â”‚  2ï¸âƒ£  SSH Tunnel Process                                     â”‚
â”‚      â€¢ Listen on localhost:5432                             â”‚
â”‚      â€¢ Forward to VPS via SSH (port 22)                     â”‚
â”‚      â€¢ Encrypt all traffic                                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ ğŸŒ Internet
                           â”‚ Port 22 (SSH)
                           â”‚ Encrypted
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VPS SERVER (165.99.59.47)                                  â”‚
â”‚                                                              â”‚
â”‚  3ï¸âƒ£  SSH Server                                             â”‚
â”‚      â€¢ Receive encrypted connection                         â”‚
â”‚      â€¢ Forward to localhost:5432 (inside VPS)              â”‚
â”‚                                                              â”‚
â”‚  4ï¸âƒ£  PostgreSQL Container                                   â”‚
â”‚      â€¢ Port 5432 (internal only, not exposed)              â”‚
â”‚      â€¢ Receive queries from SSH tunnel                      â”‚
â”‚      â€¢ Send results back                                    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Táº¡i sao báº£o máº­t?**
- PostgreSQL port **KHÃ”NG exposed** ra internet
- Táº¥t cáº£ traffic Ä‘i qua SSH (encrypted)
- Chá»‰ cáº§n SSH key (khÃ´ng cáº§n expose PostgreSQL)

---

## ğŸŒ Direct Connection (Alternative)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  YOUR COMPUTER (Localhost)                                  â”‚
â”‚                                                              â”‚
â”‚  Backend App                                                â”‚
â”‚      â†“ Connect to 165.99.59.47:5432                        â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ ğŸŒ Internet
                           â”‚ Port 5432 (PostgreSQL)
                           â”‚ âš ï¸ EXPOSED!
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VPS SERVER (165.99.59.47)                                  â”‚
â”‚                                                              â”‚
â”‚  âš ï¸  PostgreSQL Port Exposed                                â”‚
â”‚      â€¢ Port 5432 accessible from internet                   â”‚
â”‚      â€¢ Need firewall rules                                  â”‚
â”‚      â€¢ Risk of brute-force attacks                          â”‚
â”‚                                                              â”‚
â”‚  PostgreSQL Container                                       â”‚
â”‚      â€¢ 0.0.0.0:5432:5432 (exposed)                         â”‚
â”‚      â€¢ Receive queries directly                             â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Rá»§i ro:**
- âš ï¸ PostgreSQL exposed ra internet
- âš ï¸ CÃ³ thá»ƒ bá»‹ scan/attack
- âš ï¸ Cáº§n password máº¡nh
- âš ï¸ Cáº§n firewall cháº·t cháº½

---

## ğŸ‘¥ Team Collaboration

```
Developer A (Tokyo)
    Backend â”€â”€â”€â”€â”€â”
                 â”‚
Developer B (NY) â”‚         SSH Tunnels
    Backend â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  VPS PostgreSQL
                 â”‚                       (165.99.59.47)
Developer C (HN) â”‚                           â†‘
    Backend â”€â”€â”€â”€â”€â”˜                           â”‚
                                             â”‚
                    Production Backend â”€â”€â”€â”€â”€â”€â”˜
```

**Scenario:**
1. Dev A thÃªm user má»›i â†’ Ngay láº­p tá»©c visible cho Dev B, C, Production
2. Production cÃ³ bug â†’ Dev A test vá»›i production data luÃ´n
3. Migration test â†’ Cháº¡y trÃªn shared DB, verify trÆ°á»›c khi merge

---

## ğŸ“Š Performance Comparison

### SQLite Local
```
Request â†’ Backend â†’ SQLite (file I/O)
Response â† Backend â† SQLite

Latency: ~1-5ms
Throughput: 10,000+ queries/sec
```

### PostgreSQL Local
```
Request â†’ Backend â†’ Docker â†’ PostgreSQL
Response â† Backend â† Docker â† PostgreSQL

Latency: ~5-10ms
Throughput: 5,000+ queries/sec
```

### PostgreSQL Remote (SSH Tunnel)
```
Request â†’ Backend â†’ SSH Tunnel â†’ VPS â†’ PostgreSQL
Response â† Backend â† SSH Tunnel â† VPS â† PostgreSQL

Latency: ~50-200ms (tÃ¹y network)
Throughput: 100-500 queries/sec
```

**Trade-off:**
- Local: Nhanh nhÆ°ng khÃ´ng sync
- Remote: Cháº­m hÆ¡n nhÆ°ng data real-time

---

## ğŸ”„ Data Flow

### Insert Operation
```
1. User enters data in frontend (localhost:5173)
   â†“
2. Backend receives request (localhost:8000)
   â†“
3. Backend sends INSERT via SSH tunnel
   â†“
4. VPS PostgreSQL executes INSERT
   â†“
5. Response back through tunnel
   â†“
6. Frontend shows success

Total time: ~100-300ms
```

### Query Operation
```
1. Backend needs to query users
   â†“
2. Send SELECT via tunnel
   â†“
3. VPS PostgreSQL returns results
   â†“
4. Backend processes and returns

Total time: ~50-150ms per query
```

---

## ğŸ¯ Use Cases

### âœ… Tá»‘t cho:
- Solo developer
- Small team (2-5 ngÆ°á»i)
- Testing vá»›i production data
- Quick prototyping
- KhÃ´ng muá»‘n setup local DB

### âŒ KhÃ´ng tá»‘t cho:
- Large team (nhiá»u ngÆ°á»i conflict)
- Offline development
- Need high performance
- Sensitive data (khÃ´ng muá»‘n dev access production)
- Unstable internet

---

## ğŸ”’ Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: SSH Authentication                                â”‚
â”‚  â€¢ SSH key required                                          â”‚
â”‚  â€¢ Password authentication disabled                          â”‚
â”‚  â€¢ Port 22 only accessible from known IPs                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2: SSH Encryption                                    â”‚
â”‚  â€¢ AES-256 encryption                                        â”‚
â”‚  â€¢ All PostgreSQL traffic encrypted                          â”‚
â”‚  â€¢ Man-in-the-middle protection                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3: PostgreSQL Authentication                         â”‚
â”‚  â€¢ Username: utility_user                                    â”‚
â”‚  â€¢ Strong password (20+ chars)                              â”‚
â”‚  â€¢ Database: utility_db only                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 4: PostgreSQL Permissions                            â”‚
â”‚  â€¢ User can only access utility_db                          â”‚
â”‚  â€¢ No superuser privileges                                   â”‚
â”‚  â€¢ Row-level security (if needed)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Scalability

### Current Setup (OK for <10 users)
```
Localhost â”€â”€â”€â”€â†’ SSH Tunnel â”€â”€â”€â”€â†’ VPS PostgreSQL
                                      â†“
                                 Single instance
                                 No replication
```

### Future (If need scale)
```
Localhost â”€â”€â”€â”€â†’ SSH Tunnel â”€â”€â”€â”€â†’ VPS Load Balancer
                                      â†“
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â†“           â†“           â†“
                     PostgreSQL  PostgreSQL  PostgreSQL
                      (Master)    (Replica)   (Replica)
```

---

## ğŸ‰ Conclusion

**1 Database trÃªn VPS + SSH Tunnel:**
- âœ… ÄÆ¡n giáº£n nháº¥t
- âœ… Báº£o máº­t cao
- âœ… KhÃ´ng cáº§n sync
- âœ… Real-time data
- âš ï¸ Latency cao hÆ¡n
- âš ï¸ Phá»¥ thuá»™c internet

**Perfect for:** Solo dev hoáº·c small team muá»‘n simplicity + security!
