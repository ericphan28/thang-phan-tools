# âœ¨ AI TEXT TO WORD - MHTML FORMAT

## ğŸ¯ Tá»•ng Quan

TÃ­nh nÄƒng má»›i cho phÃ©p chuyá»ƒn Ä‘á»•i **vÄƒn báº£n thuáº§n (plain text)** thÃ nh **tÃ i liá»‡u Word Ä‘áº¹p máº¯t** vá»›i Ä‘á»‹nh dáº¡ng chuyÃªn nghiá»‡p, sá»­ dá»¥ng AI (Gemini/Claude) Ä‘á»ƒ phÃ¢n tÃ­ch cáº¥u trÃºc vÃ  MHTML format Ä‘á»ƒ táº¡o file `.doc`.

## ğŸŒŸ Äiá»ƒm Ná»•i Báº­t

### âœ… **Smart AI Formatting**
- AI tá»± Ä‘á»™ng nháº­n diá»‡n tiÃªu Ä‘á» (H1, H2, H3)
- TÃ¡ch sections vÃ  subsections
- Táº¡o danh sÃ¡ch bullets tá»± Ä‘á»™ng
- Highlight tÃªn ngÆ°á»i, Ä‘á»‹a Ä‘iá»ƒm, thuáº­t ngá»¯ quan trá»ng
- Táº¡o info boxes cho thÃ´ng tin quan trá»ng
- Táº¡o highlight boxes cho káº¿t luáº­n

### âœ… **Multi AI Provider**
- **Gemini** (Google): Nhanh, tiáº¿t kiá»‡m, tá»‘t cho tiáº¿ng Viá»‡t
- **Claude** (Anthropic): Cháº¥t lÆ°á»£ng cao, reasoning tá»‘t

### âœ… **Professional Output**
- Format: `.doc` (MHTML)
- Page size: A4 (21cm Ã— 29.7cm)
- Font: Times New Roman 13pt
- Thá»¥t Ä‘áº§u dÃ²ng: 1cm (chuáº©n vÄƒn báº£n Viá»‡t Nam)
- MÃ u sáº¯c vÃ  borders Ä‘áº¹p máº¯t
- TÆ°Æ¡ng thÃ­ch: Word 2000+, Google Docs, LibreOffice

### âœ… **AI Admin Integration**
- Tá»± Ä‘á»™ng láº¥y API keys tá»« há»‡ thá»‘ng AI Admin
- Budget checking trÆ°á»›c khi xá»­ lÃ½
- Usage tracking vÃ  cost calculation
- Log chi tiáº¿t cho audit

## ğŸ—ï¸ Kiáº¿n TrÃºc

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚  Input Text â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Backend API               â”‚
â”‚  /text-to-word-smart        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI Admin System            â”‚
â”‚  â€¢ Get API Key              â”‚
â”‚  â€¢ Check Budget             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI Provider                â”‚
â”‚  â€¢ Gemini: Analyze text     â”‚
â”‚  â€¢ Claude: Structure data   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MHTML Generator            â”‚
â”‚  â€¢ Generate HTML            â”‚
â”‚  â€¢ Add Word metadata        â”‚
â”‚  â€¢ CSS styling              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   .doc File                 â”‚
â”‚   Download to user          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ File Structure

```
backend/
â”œâ”€â”€ app/services/document_service.py
â”‚   â”œâ”€â”€ text_to_word_mhtml()          # Main function
â”‚   â”œâ”€â”€ _format_text_with_gemini()    # Gemini integration
â”‚   â”œâ”€â”€ _format_text_with_claude()    # Claude integration
â”‚   â”œâ”€â”€ _build_format_prompt()        # Prompt engineering
â”‚   â”œâ”€â”€ _generate_mhtml()             # MHTML generation
â”‚   â””â”€â”€ _escape_html()                # HTML sanitization
â”‚
â””â”€â”€ app/api/v1/endpoints/documents.py
    â”œâ”€â”€ POST /text-to-word-smart      # Main endpoint
    â””â”€â”€ GET  /ai-providers            # List providers

frontend/
â””â”€â”€ src/pages/TextToWordPage.tsx      # React UI
```

## ğŸ”§ CÃ¡ch Sá»­ Dá»¥ng

### 1ï¸âƒ£ **Setup API Keys (One-time)**

VÃ o trang **AI Keys Management** vÃ  thÃªm API keys:

```bash
# Gemini API Key
Provider: gemini
Key Name: "Gemini Primary"
API Key: AIzaSy...
Is Primary: âœ…
Is Active: âœ…

# Claude API Key (optional)
Provider: claude
Key Name: "Claude Sonnet"
API Key: sk-ant-...
Is Primary: âœ…
Is Active: âœ…
```

### 2ï¸âƒ£ **Sá»­ dá»¥ng UI**

1. Má»Ÿ trang **AI Textâ†’Word** tá»« sidebar
2. Nháº­p vÄƒn báº£n (tá»‘i thiá»ƒu 10 kÃ½ tá»±)
3. Chá»n AI Provider (Gemini/Claude)
4. Chá»n Model (optional)
5. Chá»n ngÃ´n ngá»¯ (vi/en/zh/ja...)
6. Click **"Táº¡o Word Document"**
7. File `.doc` tá»± Ä‘á»™ng download

### 3ï¸âƒ£ **Sá»­ dá»¥ng API**

#### **Request:**
```bash
curl -X POST "http://localhost:8000/api/v1/documents/text-to-word-smart" \
  -F "text=BÃ¡o cÃ¡o dá»± Ã¡n ABC..." \
  -F "provider=gemini" \
  -F "model=gemini-2.5-flash" \
  -F "language=vi" \
  --output document.doc
```

#### **Response Headers:**
```
X-Technology-Engine: gemini
X-Technology-Name: Gemini AI
X-Technology-Model: gemini-2.5-flash
X-Technology-Quality: 8/10
X-Input-Tokens: 523
X-Output-Tokens: 1847
X-Processing-Time-Ms: 3421
```

### 4ï¸âƒ£ **Python Script**

```bash
python test_text_to_word.py
```

Káº¿t quáº£:
- `output_gemini.doc` - Gemini generated
- `output_claude.doc` - Claude generated (if enabled)

## ğŸ¨ AI Auto-Detection

### **Input Example:**
```
BÃ¡o cÃ¡o dá»± Ã¡n Website

Giá»›i thiá»‡u: Dá»± Ã¡n Ä‘Æ°á»£c khá»Ÿi Ä‘á»™ng...

CÃ¡c tÃ­nh nÄƒng chÃ­nh:
- TÃ¬m kiáº¿m thÃ´ng minh
- Thanh toÃ¡n Ä‘a phÆ°Æ¡ng thá»©c
- Quáº£n lÃ½ Ä‘Æ¡n hÃ ng realtime

Tiáº¿n Ä‘á»™: Giai Ä‘oáº¡n 1 hoÃ n thÃ nh 100%...

Káº¿t luáº­n: Dá»± Ã¡n Ä‘i Ä‘Ãºng tiáº¿n Ä‘á»™.
```

### **AI Output:**
```json
{
  "title": "BÃ¡o cÃ¡o dá»± Ã¡n Website",
  "sections": [
    {
      "heading": "Giá»›i thiá»‡u",
      "level": 1,
      "content": [
        {
          "type": "paragraph",
          "text": "Dá»± Ã¡n Ä‘Æ°á»£c khá»Ÿi Ä‘á»™ng...",
          "highlights": ["Dá»± Ã¡n"]
        }
      ]
    },
    {
      "heading": "CÃ¡c tÃ­nh nÄƒng chÃ­nh",
      "level": 1,
      "content": [
        {
          "type": "list",
          "items": [
            "TÃ¬m kiáº¿m thÃ´ng minh",
            "Thanh toÃ¡n Ä‘a phÆ°Æ¡ng thá»©c",
            "Quáº£n lÃ½ Ä‘Æ¡n hÃ ng realtime"
          ]
        }
      ]
    },
    {
      "heading": "Káº¿t luáº­n",
      "level": 1,
      "content": [
        {
          "type": "highlight_box",
          "title": "Káº¾T LUáº¬N",
          "text": "Dá»± Ã¡n Ä‘i Ä‘Ãºng tiáº¿n Ä‘á»™."
        }
      ]
    }
  ]
}
```

## ğŸ“Š Technology Comparison

### **MHTML (This Feature) vs python-docx**

| Feature | MHTML | python-docx |
|---------|-------|-------------|
| **Complexity** | â­â­ Simple | â­â­â­â­ Complex |
| **File Format** | .doc (old) | .docx (modern) |
| **Quality** | 8/10 | 9.5/10 |
| **Client-side** | âœ… Yes | âŒ No |
| **Speed** | âš¡ Fast | ğŸ¢ Medium |
| **Dependencies** | None | python-docx |
| **AI Integration** | âœ… Easy | âš ï¸ Medium |
| **Tables** | âš ï¸ HTML | âœ… Native |
| **Images** | Base64 | âœ… Native |

### **When to use MHTML?**
- âœ… Simple text documents
- âœ… Fast generation needed
- âœ… Client-side export
- âœ… AI-powered formatting

### **When to use python-docx?**
- âœ… Complex layouts
- âœ… Native tables/charts
- âœ… Images from URLs
- âœ… Track changes/comments

## ğŸ’° Cost Estimation

### **Gemini (Recommended)**
```
Model: gemini-2.5-flash
Input:  $0.50 / 1M tokens
Output: $2.00 / 1M tokens

Average document (2000 words):
â€¢ Input tokens:  ~500
â€¢ Output tokens: ~1500
â€¢ Total cost: $0.003 (0.003 USD)
```

### **Claude**
```
Model: claude-3-5-sonnet
Input:  $3.00 / 1M tokens
Output: $15.00 / 1M tokens

Average document (2000 words):
â€¢ Input tokens:  ~500
â€¢ Output tokens: ~1500
â€¢ Total cost: $0.024 (0.024 USD)
```

**ğŸ’¡ Tip:** Gemini 8x ráº» hÆ¡n Claude cho use case nÃ y!

## ğŸ” Debugging

### **Check AI Keys:**
```bash
curl http://localhost:8000/api/v1/ai-admin/keys | jq
```

### **Check Budget:**
```bash
curl http://localhost:8000/api/v1/ai-admin/balance/gemini | jq
```

### **View Logs:**
```bash
curl http://localhost:8000/api/v1/ai-admin/usage-logs?provider=gemini | jq
```

## ğŸš€ Next Steps

### **Possible Enhancements:**
1. âœ¨ Add table support (auto-detect tabular data)
2. ğŸ–¼ï¸ Support images (Base64 embed)
3. ğŸ“Š Generate charts from data
4. ğŸ¨ Custom templates (corporate, academic, etc.)
5. ğŸŒ Support more languages (Thai, Indonesian, etc.)
6. ğŸ’¾ Save templates to database
7. ğŸ“± Mobile app integration

## ğŸ“ Example Use Cases

### 1. **Meeting Minutes**
```
Input: Raw notes from meeting
Output: Formatted document with sections, attendees, action items
```

### 2. **Project Reports**
```
Input: Project progress text
Output: Professional report with intro, milestones, conclusion
```

### 3. **Content Articles**
```
Input: Blog post or article text
Output: Formatted document with headings, quotes, highlights
```

### 4. **Resume/CV**
```
Input: Career information
Output: Structured resume with sections
```

## ğŸ¯ Best Practices

1. **Chuáº©n bá»‹ text tá»‘t:**
   - DÃ¹ng line breaks Ä‘á»ƒ tÃ¡ch sections
   - DÃ¹ng `-` hoáº·c `â€¢` cho lists
   - Äáº·t tiÃªu Ä‘á» rÃµ rÃ ng

2. **Chá»n provider phÃ¹ há»£p:**
   - Gemini: VÄƒn báº£n Ä‘Æ¡n giáº£n, tiáº¿ng Viá»‡t
   - Claude: Ná»™i dung phá»©c táº¡p, cáº§n reasoning

3. **Monitor costs:**
   - Set monthly limits trong AI Admin
   - Review usage logs thÆ°á»ng xuyÃªn

4. **Test output:**
   - Kiá»ƒm tra file trong Word trÆ°á»›c khi gá»­i
   - Adjust text náº¿u format khÃ´ng Ä‘Ãºng Ã½

## ğŸ“ Support

- **Documentation:** [AI_CONTEXT.md](./AI_CONTEXT.md)
- **API Docs:** http://localhost:8000/docs
- **Test Script:** `python test_text_to_word.py`

---

**Made with â¤ï¸ using Claude AI's MHTML technique**
